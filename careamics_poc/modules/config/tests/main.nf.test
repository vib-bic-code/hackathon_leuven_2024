nextflow_process {

    name "Test Process CONFIGURATION"
    script "../main.nf"
    process "configuration"

    tag "modules"
    tag "modules_local"
    tag "careamics"
    tag "configuration"

    test("create  yaml configuration file") {

        when {
            process {
                """
                input[0] = tuple(
                    "n2v",
                    "test_experiment", 
                    32,
                    "64 64 -1",
                    100,
                    "YX"
                )
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert process.out.config.size() == 1 },
                { assert path(process.out.config[0]).exists() },
                {assert snapshot(process.out.config[0]).match("config")}
            )
        }
    }

    test("stub") {

        options "-stub"

        when {
            process {
                """
                input[0] = tuple(
                    "n2v",
                    "stub_test",
                    32,
                    "64 64 -1",
                    50,
                    "YX"
                )
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out).match()}
            )
        }
    }
}
