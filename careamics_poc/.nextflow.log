Dec-11 17:18:37.249 [main] DEBUG nextflow.cli.Launcher - $> nextflow run main_n2n_care_cli.nf -c care_n2n_cli.config -profile conda_wsl --basepath /home/tatiana
Dec-11 17:18:37.402 [main] DEBUG nextflow.cli.CmdRun - N E X T F L O W  ~  version 25.04.6
Dec-11 17:18:37.439 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/tatiana/.nextflow/plugins; core-plugins: nf-amazon@2.15.0,nf-azure@1.16.0,nf-cloudcache@0.4.3,nf-codecommit@0.2.3,nf-console@1.2.1,nf-google@1.21.1,nf-k8s@1.0.0,nf-tower@1.11.4,nf-wave@1.12.1
Dec-11 17:18:37.460 [main] INFO  o.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Dec-11 17:18:37.461 [main] INFO  o.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Dec-11 17:18:37.464 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.12.0 in 'deployment' mode
Dec-11 17:18:37.476 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Dec-11 17:18:37.503 [main] DEBUG nextflow.config.ConfigBuilder - User config file: /home/tatiana/hackathon_leuven_2024/careamics_poc/care_n2n_cli.config
Dec-11 17:18:37.506 [main] DEBUG nextflow.config.ConfigBuilder - Parsing config file: /home/tatiana/hackathon_leuven_2024/careamics_poc/care_n2n_cli.config
Dec-11 17:18:37.549 [main] DEBUG n.secret.LocalSecretsProvider - Secrets store: /home/tatiana/.nextflow/secrets/store.json
Dec-11 17:18:37.556 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@6bff19ff] - activable => nextflow.secret.LocalSecretsProvider@6bff19ff
Dec-11 17:18:37.576 [main] DEBUG nextflow.config.ConfigBuilder - Applying config profile: `conda_wsl`
Dec-11 17:18:38.529 [main] DEBUG nextflow.config.ConfigBuilder - Available config profiles: [apptainer_wsl, docker_wsl, conda_wsl]
Dec-11 17:18:38.569 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 by global default
Dec-11 17:18:38.584 [main] DEBUG nextflow.cli.CmdRun - Launching `main_n2n_care_cli.nf` [sad_plateau] DSL2 - revision: 16256360a6
Dec-11 17:18:38.586 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Dec-11 17:18:38.586 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Dec-11 17:18:38.638 [main] DEBUG nextflow.Session - Session UUID: 59e7ff47-cd86-4235-839e-6a626415aa70
Dec-11 17:18:38.639 [main] DEBUG nextflow.Session - Run name: sad_plateau
Dec-11 17:18:38.639 [main] DEBUG nextflow.Session - Executor pool size: 22
Dec-11 17:18:38.647 [main] DEBUG nextflow.file.FilePorter - File porter settings maxRetries=3; maxTransfers=50; pollTimeout=null
Dec-11 17:18:38.654 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=66; workQueue=LinkedBlockingQueue[-1]; allowCoreThreadTimeout=false
Dec-11 17:18:38.678 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 25.04.6 build 5954
  Created: 01-07-2025 11:27 UTC (13:27 CEST)
  System: Linux 6.6.87.2-microsoft-standard-WSL2
  Runtime: Groovy 4.0.26 on OpenJDK 64-Bit Server VM 17.0.17+10-Ubuntu-124.04
  Encoding: UTF-8 (UTF-8)
  Process: 199423@GBW-L-W4910 [127.0.1.1]
  CPUs: 22 - Mem: 31.1 GB (25.4 GB) - Swap: 8 GB (8 GB)
Dec-11 17:18:38.710 [main] DEBUG nextflow.Session - Work-dir: /home/tatiana/work_nextflow [ext2/ext3]
Dec-11 17:18:38.749 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
Dec-11 17:18:38.759 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Dec-11 17:18:38.765 [main] DEBUG nextflow.Session - Observer factory (v2): LinObserverFactory
Dec-11 17:18:38.797 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Dec-11 17:18:38.806 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 23; maxThreads: 1000
Dec-11 17:18:38.875 [main] DEBUG nextflow.Session - Session start
Dec-11 17:18:39.068 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Dec-11 17:18:39.387 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_gpu_medium` matches labels `process_gpu_medium` for process with name TRAIN_N2N_CARE_CLI
Dec-11 17:18:39.391 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:TRAIN_N2N_CARE_CLI` matches process TRAIN_N2N_CARE_CLI
Dec-11 17:18:39.400 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-11 17:18:39.401 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-11 17:18:39.409 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
Dec-11 17:18:39.417 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=22; memory=31.1 GB; capacity=22; pollInterval=100ms; dumpInterval=5m
Dec-11 17:18:39.419 [main] DEBUG n.processor.TaskPollingMonitor - >>> barrier register (monitor: local)
Dec-11 17:18:39.442 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'TRAIN_N2N_CARE_CLI': maxForks=0; fair=false; array=0
Dec-11 17:18:39.499 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withLabel:process_gpu_medium` matches labels `process_gpu_medium` for process with name PREDICT_CLI
Dec-11 17:18:39.502 [main] DEBUG nextflow.script.ProcessConfig - Config settings `withName:PREDICT_CLI` matches process PREDICT_CLI
Dec-11 17:18:39.505 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-11 17:18:39.506 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-11 17:18:39.508 [main] DEBUG nextflow.processor.TaskProcessor - Creating process 'PREDICT_CLI': maxForks=0; fair=false; array=0
Dec-11 17:18:39.510 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: TRAIN_N2N_CARE_CLI, PREDICT_CLI
Dec-11 17:18:39.519 [main] WARN  nextflow.Session - There's no process matching config selector: TRAIN_N2V_CLI
Dec-11 17:18:39.523 [main] DEBUG nextflow.Session - Igniting dataflow network (4)
Dec-11 17:18:39.529 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > TRAIN_N2N_CARE_CLI
Dec-11 17:18:39.531 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > PREDICT_CLI
Dec-11 17:18:39.532 [main] DEBUG nextflow.script.ScriptRunner - Parsed script files:
  Script_32558b19656b9382: /home/tatiana/hackathon_leuven_2024/careamics_poc/main_n2n_care_cli.nf
  Script_447d462b9be3c7e3: /home/tatiana/hackathon_leuven_2024/careamics_poc/modules/predict_cli.nf
  Script_7f9fab0495712349: /home/tatiana/hackathon_leuven_2024/careamics_poc/modules/train_n2n_care_cli.nf
Dec-11 17:18:39.532 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Dec-11 17:18:39.532 [main] DEBUG nextflow.Session - Session await
Dec-11 17:18:39.532 [PathVisitor-2] DEBUG nextflow.file.PathVisitor - files for syntax: glob; folder: /home/tatiana/test_careamics/N2N_data/test/; pattern: *.{tif,tiff}; options: [checkIfExists:true]
Dec-11 17:18:39.677 [Actor Thread 19] DEBUG nextflow.conda.CondaCache - conda found local env for environment=/home/tatiana/miniconda3/envs/careamics; path=/home/tatiana/miniconda3/envs/careamics
Dec-11 17:18:39.761 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-11 17:18:39.764 [Task submitter] INFO  nextflow.Session - [3c/ebe830] Submitted process > TRAIN_N2N_CARE_CLI (1)
Dec-11 17:19:40.838 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 1; name: TRAIN_N2N_CARE_CLI (1); status: COMPLETED; exit: 0; error: -; workDir: /home/tatiana/work_nextflow/3c/ebe830bc2dc31ce1b280343c9dae60]
Dec-11 17:19:40.839 [Task monitor] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'TaskFinalizer' minSize=10; maxSize=66; workQueue=LinkedBlockingQueue[-1]; allowCoreThreadTimeout=false
Dec-11 17:19:40.864 [TaskFinalizer-1] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'PublishDir' minSize=10; maxSize=66; workQueue=LinkedBlockingQueue[-1]; allowCoreThreadTimeout=false
Dec-11 17:19:40.866 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-11 17:19:40.867 [Task submitter] INFO  nextflow.Session - [12/26b2f8] Submitted process > PREDICT_CLI (1)
Dec-11 17:19:48.243 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 2; name: PREDICT_CLI (1); status: COMPLETED; exit: 1; error: -; workDir: /home/tatiana/work_nextflow/12/26b2f86e532b335771062eea4c75b7]
Dec-11 17:19:48.247 [TaskFinalizer-2] DEBUG nextflow.processor.TaskProcessor - Handling unexpected condition for
  task: name=PREDICT_CLI (1); work-dir=/home/tatiana/work_nextflow/12/26b2f86e532b335771062eea4c75b7
  error [nextflow.exception.ProcessFailedException]: Process `PREDICT_CLI (1)` terminated with an error exit status (1)
Dec-11 17:19:48.261 [TaskFinalizer-2] ERROR nextflow.processor.TaskProcessor - Error executing process > 'PREDICT_CLI (1)'

Caused by:
  Process `PREDICT_CLI (1)` terminated with an error exit status (1)


Command executed:

  predict.py --trained_model last.ckpt --test_data test.tif  --tile_size 256 256 --tile_overlap 48 48 --axes SYX --data_type tiff --write_type tiff --batch_size 64

Command exit status:
  1

Command output:
  (empty)

Command error:
  No working directory provided. Using current working directory: /home/tatiana/work_nextflow/12/26b2f86e532b335771062eea4c75b7.
  /home/tatiana/miniconda3/envs/careamics/lib/python3.12/site-packages/careamics/model_io/model_io_utils.py:74: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
    checkpoint: dict = torch.load(path, map_location=device)
  GPU available: True (cuda), used: True
  TPU available: False, using: 0 TPU cores
  HPU available: False, using: 0 HPUs
  Traceback (most recent call last):
    File "/home/tatiana/hackathon_leuven_2024/careamics_poc/bin/predict.py", line 33, in <module>
      prediction_careamist(test_data_path,model_path, tilesize, tileoverlap, ax, int(batch_size), datatype, writetype)
    File "/home/tatiana/hackathon_leuven_2024/careamics_poc/bin/predict.py", line 12, in prediction_careamist
      careamics_pretrained.predict_to_disk(source=data_path, tile_size=tilesize, tile_overlap=tileoverlap, axes=ax, batch_size=batchsize, data_type=datatype, write_type=writetype)
    File "/home/tatiana/miniconda3/envs/careamics/lib/python3.12/site-packages/careamics/careamist.py", line 850, in predict_to_disk
      prediction = self.predict(
                   ^^^^^^^^^^^^^
    File "/home/tatiana/miniconda3/envs/careamics/lib/python3.12/site-packages/careamics/careamist.py", line 663, in predict
      if t % tile_increment != 0:
         ~~^~~~~~~~~~~~~~~~
  TypeError: not all arguments converted during string formatting

Work dir:
  /home/tatiana/work_nextflow/12/26b2f86e532b335771062eea4c75b7

Tip: you can try to figure out what's wrong by changing to the process work dir and showing the script file named `.command.sh`
Dec-11 17:19:48.264 [main] DEBUG nextflow.Session - Session await > all processes finished
Dec-11 17:19:48.264 [TaskFinalizer-2] INFO  nextflow.Session - Execution cancelled -- Finishing pending tasks before exit
Dec-11 17:19:48.273 [Task monitor] DEBUG n.processor.TaskPollingMonitor - <<< barrier arrives (monitor: local) - terminating tasks monitor poll loop
Dec-11 17:19:48.273 [main] DEBUG nextflow.Session - Session await > all barriers passed
Dec-11 17:19:48.277 [main] DEBUG nextflow.util.ThreadPoolManager - Thread pool 'TaskFinalizer' shutdown completed (hard=false)
Dec-11 17:19:48.278 [main] DEBUG nextflow.util.ThreadPoolManager - Thread pool 'PublishDir' shutdown completed (hard=false)
Dec-11 17:19:48.286 [main] DEBUG n.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=1; failedCount=1; ignoredCount=0; cachedCount=0; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=8m 8s; failedDuration=58.4s; cachedDuration=0ms;loadCpus=0; loadMemory=0; peakRunning=1; peakCpus=8; peakMemory=16 GB; ]
Dec-11 17:19:48.482 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Dec-11 17:19:48.494 [main] DEBUG nextflow.util.ThreadPoolManager - Thread pool 'FileTransfer' shutdown completed (hard=false)
Dec-11 17:19:48.495 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
